#It is generated by the source task as:create_aci_contract_subject.yml
  - name: Pre Query Subject to Contracts
    aci_contract_subject:
      host: "{{ inventory_hostname }}"
      username: "{{ username }}"
      password: "{{ password }}"
      validate_certs: no
      tenant: "{{ item.tenant }}"
      contract: "{{ item.ct_Name }}"
      subject: "{{ item.sub_Name }}"
      reverse_filter: yes
      consumer_match: at_least_one
      provider_match: at_least_one
      state: query
    register: query_result
    with_items: "{{ aci_contract_subject }}"
    ignore_errors: yes


  - name: Assert the existing object
    assert:
      that:
      - item.current == []
      success_msg: "Object does not exist. Can create it."
      fail_msg: "Object exists. DO NOT recreate it!"
    with_items: "{{query_result.results}}"

